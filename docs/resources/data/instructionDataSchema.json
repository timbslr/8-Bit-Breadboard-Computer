{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "$schema": "string",
    "instructions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 3
          },
          "mnemonic": {
            "type": "string",
            "minLength": 2
          },
          "type": {
            "type": "string",
            "pattern": "^(REAL|PSEUDO)$"
          },
          "operands": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^(reg|lcdreg|imm|addr|n|regd|regs|regsd|regss)$"
            }
          },
          "requiresFlag": {
            "type": "boolean"
          },
          "opcode": {
            "type": "string",
            "minLength": 8,
            "maxLength": 8,
            "pattern": "(0|1|R|L){8}"
          },
          "microinstructions": {},
          "mappedInstructions": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 4
            },
            "minItems": 1
          },
          "group": {
            "type": "string",
            "pattern": "^(ALU|REG-MEM|I-O|SYS|BR-JMP)$"
          },
          "indexInGroup": {
            "type": "number"
          },
          "shortDescription": {
            "type": "string",
            "minLength": 5
          },
          "longDescription": {
            "type": "string",
            "minLength": 20
          },
          "examples": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "code": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "minLength": 2
                  },
                  "minItems": 1
                },
                "result": {
                  "type": "string",
                  "minLength": 3
                }
              },
              "required": ["code", "result"],
              "additionalProperties": false
            },
            "minItems": 1
          }
        },
        "required": [
          "name",
          "mnemonic",
          "type",
          "operands",
          "group",
          "indexInGroup",
          "shortDescription",
          "longDescription",
          "examples"
        ],
        "additionalProperties": false,
        "allOf": [
          {
            "if": {
              "properties": {
                "type": {
                  "const": "REAL"
                }
              }
            },
            "then": {
              "required": [
                "requiresFlag",
                "opcode",
                "microinstructions"
              ],
              "not": {
                "required": ["mappedInstructions"]
              }
            }
          },
          {
            "if": {
              "properties": {
                "type": {
                  "const": "PSEUDO"
                }
              }
            },
            "then": {
              "not": {
                "required": [
                  "requiresFlag",
                  "opcode",
                  "microinstructions"
                ]
              },
              "required": ["mappedInstructions"]
            }
          },
          {
            "if": {
              "properties": {
                "requiresFlag": {
                  "const": false
                }
              }
            },
            "then": {
              "properties": {
                "microinstructions": {
                  "type": "array",
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "pattern": "^(OE_<regs>|IE_<regd>|OE_<regss>|IE_<regsd>|OE_<reg>|IE_<reg>|IE_MAR_H|IE_PC_H|IE_PC_L|RSC|IE_A|IE_SP_H|IE_SP_L|IE_BUF|IE_MAR_L|INC_PC|IE_F|IE_B|IE_X|LCD_<lcdreg>|LCD_E|LCD_READ|LCD_WRITE|IE_7SD|MEM_WE|ALU_BOP_AND|ALU_BOP_OR|ALU_BOP_XOR|ALU_BOP_NOT|ALU_BOP_SLR|ALU_BOP_SAR|ALU_BOP_ROR||ALU_BOP_ROL|ALU_SRC_ARI|ALU_SRC_BIT|ALU_CIN|ALU_AOP_ADD|ALU_AOP_SUB|IE_IR|OE_X|OE_ALU|OE_PC_L|OE_PC_H|OE_F|OE_A|OE_T|OE_B|OE_SP_L|OE_SP_H|OE_IR|OE_BUF|IE_T|MEM_EN_IO|INC_X|DEC_X|HALT)$"
                    }
                  },
                  "maxItems": 16
                }
              }
            }
          },
          {
            "if": {
              "properties": {
                "requiresFlag": {
                  "const": true
                }
              }
            },
            "then": {
              "properties": {
                "microinstructions": {
                  "type": "object",
                  "properties": {
                    "0": {
                      "type": "array",
                      "items": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "pattern": "^(OE_<regs>|IE_<regd>|OE_<regss>|IE_<regsd>|OE_<reg>|IE_<reg>|IE_MAR_H|IE_PC_H|IE_PC_L|RSC|IE_A|IE_SP_H|IE_SP_L|IE_BUF|IE_MAR_L|INC_PC|IE_F|IE_B|IE_X|LCD_<lcdreg>|LCD_E|LCD_READ|LCD_WRITE|IE_7SD|MEM_WE|ALU_BOP_AND|ALU_BOP_OR|ALU_BOP_XOR|ALU_BOP_NOT|ALU_BOP_SLR|ALU_BOP_SAR|ALU_BOP_ROR||ALU_BOP_ROL|ALU_SRC_ARI|ALU_SRC_BIT|ALU_CIN|ALU_AOP_ADD|ALU_AOP_SUB|IE_IR|OE_X|OE_ALU|OE_PC_L|OE_PC_H|OE_F|OE_A|OE_T|OE_B|OE_SP_L|OE_SP_H|OE_IR|OE_BUF|IE_T|MEM_EN_IO|INC_X|DEC_X|HALT)$"
                        }
                      },
                      "maxItems": 16
                    },
                    "1": {
                      "type": "array",
                      "items": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "pattern": "^(OE_<regs>|IE_<regd>|OE_<regss>|IE_<regsd>|OE_<reg>|IE_<reg>|IE_MAR_H|IE_PC_H|IE_PC_L|RSC|IE_A|IE_SP_H|IE_SP_L|IE_BUF|IE_MAR_L|INC_PC|IE_F|IE_B|IE_X|LCD_<lcdreg>|LCD_E|LCD_READ|LCD_WRITE|IE_7SD|MEM_WE|ALU_BOP_AND|ALU_BOP_OR|ALU_BOP_XOR|ALU_BOP_NOT|ALU_BOP_SLR|ALU_BOP_SAR|ALU_BOP_ROR||ALU_BOP_ROL|ALU_SRC_ARI|ALU_SRC_BIT|ALU_CIN|ALU_AOP_ADD|ALU_AOP_SUB|IE_IR|OE_X|OE_ALU|OE_PC_L|OE_PC_H|OE_F|OE_A|OE_T|OE_B|OE_SP_L|OE_SP_H|OE_IR|OE_BUF|IE_T|MEM_EN_IO|INC_X|DEC_X|HALT)$"
                        }
                      },
                      "maxItems": 16
                    }
                  },
                  "required": ["0", "1"],
                  "additionalProperties": false
                }
              }
            }
          }
        ]
      }
    }
  },
  "required": ["$schema", "instructions"],
  "additionalProperties": false
}
